<?xml version="1.0" encoding="utf-8"?>
<mx:Box xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%"
	creationComplete="init();"
	>
	<mx:Style source="style/main.css"/>
	<mx:Script>
		<![CDATA[
			import com.ResultFilter;
			import mx.controls.Alert;
			import com.pioneer.http.UrlService;
			import mx.rpc.http.mxml.HTTPService;
			import mx.rpc.events.ResultEvent;
			import mx.rpc.events.FaultEvent;
			private function init():void{
				var now:Date=new Date();
				var year:int=now.getFullYear();
				var m:int=now.getMonth();
				m++;
				var mstr:String="";
				if(m<10)
				mstr="0"+m;
				else
				mstr=""+m;
				
				var day:int=now.getDate();
				var dayStr:String="";
				if(day<10){
					dayStr="0"+day;
				}else{
					dayStr=""+day;
				}
				var dateStr:String=year+ mstr+dayStr;
				if(m<=1){
					m=12;
					year--;
				}else{
					m--;
					
				}
				
				var smstr:String=""+year;
				if(m<10){
					smstr+="0"+m;
				}else{
					smstr+=m;
				}
				
				if(day<10){
					smstr+="0"+day;
				}else{
					smstr+=day;
				}
				this.enddate.text=dateStr;
				this.startdate.text=smstr;
				getData();
				otherMoney.setFocus();
			}	
			
			private function getData():void{
				var doc:XML=<DATAPACKET/>;
				doc.@ACTION="shopstatus";
				doc.@STARTDATE=startdate.text;
				doc.@ENDDATE=enddate.text;
				var dataService:HTTPService = new HTTPService();
				dataService.url = UrlService.getGoodCDSURL();
				dataService.contentType="application/xml";     
				dataService.method="POST";
				dataService.resultFormat = "e4x";
				dataService.showBusyCursor=true;
				dataService.addEventListener(FaultEvent.FAULT, httpFault);
				dataService.addEventListener(ResultEvent.RESULT, doStatusData);
				dataService.send(doc);
			}
			private function httpFault(event:FaultEvent):void {
                var faultstring:String = event.fault.faultString;
                Alert.show("网络错误，请重试！");
            }
            
            private function doStatusData(event:ResultEvent):void{
            	
            	var xml:XML = (XML)(event.result);
            	if(!ResultFilter.filter(xml))return;
            	//Alert.show(xml.toXMLString());
            	this.salemoney.text=xml.@SALEMONEY;
            	this.useMoney.text=xml.@USEMONEY;
            	this.money.text=xml.@MONEY;
            	
            	
            	this.storeLittle.text=xml.@GOODLITTLE;
            	this.dayLazyenum.text=xml.@DAYLAZYE;
            	this.monthLazyenum.text=xml.@MONTHLAZYE;
            	this.outdaygood.text=xml.@OUTDAY;
            	this.otherMoney.text=xml.@SPENDING;
            	calculate();
            }
			
			private function calculate():void{
				money.text=""+(Number(salemoney.text)-Number(useMoney.text)-Number(otherMoney.text));
			}
				
		]]>
	</mx:Script>
	<mx:Box width="100%" height="100%" horizontalAlign="center" verticalAlign="middle">
		<mx:Panel width="50%" height="70%" title="商品情况" styleName="label">
				<mx:Box width="80%" horizontalAlign="center" verticalAlign="middle">
					<mx:Box height="90"/>
					<mx:HBox width="50%">
						<mx:Label styleName="label" text="库存报警数：" width="100"/>
						<mx:Label id="storeLittle"  styleName="label"/>	<mx:Label text="种"/>			
					</mx:HBox>
					<mx:HBox width="50%">
						<mx:Label styleName="label" text="昨天滞销商品：" width="100"/>
						<mx:Label id="dayLazyenum"  styleName="label"/>	<mx:Label text="种"/>			
					</mx:HBox>
					<mx:HBox width="50%">
						<mx:Label styleName="label" text="近期滞销商品：" width="100"/>
						<mx:Label id="monthLazyenum"  styleName="label"/>	<mx:Label text="种"/>			
					</mx:HBox>
					<mx:HBox width="50%">
						<mx:Label styleName="label" text="将过期商品：" width="100"/>
						<mx:Label id="outdaygood"  styleName="label"/>	<mx:Label text="种"/>			
					</mx:HBox>
				</mx:Box>
					
				</mx:Panel>
		<mx:Panel width="50%" height="70%" title="运营情况" styleName="label">
			<mx:ApplicationControlBar width="100%" height="39" barColor="#e0" alpha="1">
				<mx:Label text="开始时间：" styleName="label"/>
				<mx:DateField id="startdate" editable="true" formatString="YYYYMMDD" text=""  styleName="textInput" dayNames="['日','一','二','三','四','五','六']" monthNames="['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月']"/>
				<mx:Label text="结束时间：" styleName="label"/>
				<mx:DateField id="enddate" editable="true" formatString="YYYYMMDD" styleName="textInput" dayNames="['日','一','二','三','四','五','六']" monthNames="['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月']"/> 
				<mx:Button click="getData();" label="查询" styleName="detailbtn"/>
			</mx:ApplicationControlBar>
			<mx:Box width="80%" horizontalAlign="center" verticalAlign="middle">
				<mx:Box height="90"/>
				
				
				
				<mx:HBox width="50%">
					<mx:Label styleName="label" text="销售额：" width="100"/>
					<mx:Label id="salemoney"  styleName="label"/>				
				</mx:HBox>
				<mx:HBox width="50%">
					<mx:Label text="成本：" styleName="label" width="100"/>
					<mx:Label id="useMoney" styleName="label"/>
				</mx:HBox>
				<mx:HBox width="50%">
					<mx:Label text="日常开支：" styleName="label" width="100"/>
					<mx:TextInput id="otherMoney" keyUp="calculate();" text="0" width="60" styleName="textInput"/>
				</mx:HBox>
				<mx:HBox width="50%">
					<mx:Label text="运营收入：" styleName="label" width="100"/>
					<mx:Label id="money" styleName="label"/>
				</mx:HBox>
			</mx:Box>
		</mx:Panel>
	</mx:Box>
</mx:Box>
