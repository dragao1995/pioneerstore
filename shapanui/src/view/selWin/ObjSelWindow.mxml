<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" 
	creationComplete="init();"
	alpha="1"
	width="250" height="400" xmlns:list="view.list.*">
	<mx:Script>
		<![CDATA[
			/**
			 * 选择一个对象信息，检索结果选择。
			 * */
			import view.fk.FKTextInput;
			import mx.containers.Box;
			import event.list.ListClickEnent;
			import mx.controls.Alert;
			import mx.managers.PopUpManager;
			private var tblName:String=null;
			private var obj:Object=null;
			private var fkInput:FKTextInput=null;
			private var parentbox:Object=null;
			private var condition:Object="";
			private function init():void{
				//searchrs.addEventListener(ListClickEnent.ROW_CLICK,setObj,false,0,false);
				searchrs.addEventListener(ListClickEnent.rowClick,setObj,false,0,false);
			}
			 public function setFKInput(fkInput:FKTextInput):void{
            	this.fkInput=fkInput;
            }
            public function setParent(fkInput:FKTextInput):void{
            	this.fkInput=fkInput;
            }
			public function setParentBox(parentbox:Object):void{
				this.parentbox=parentbox;
			}
			public function setMeta(tblName:String):void{
				this.tblName=tblName;
				searchrs.tbName=this.tblName;
			}
			public function setCondition(condition):void{
				this.condition=condition;
			}
			private function search():void{
				if(null==keyinput.text){
					Alert.show("请输入搜索条件！");
					return;
				}
				if(""!=this.condition){
					searchrs.setCondition(this.condition+" and NAME like'%"+keyinput.text+"%'");
				}else{
					searchrs.setCondition(" NAME like'%"+keyinput.text+"%'");
				}
				
				
				
			}
			
			private function keysearch(e:KeyboardEvent):void{
				//Alert.show("e.keyCode="+e.keyCode);
				if(e.keyCode==13){
					search();
				}
			}
			
			public function addObj():void{
				if(null==this.obj){
					Alert.show("请选择确认的内容！");
					return;
				}
				try{
					//var box:Object=Object(this.parent);

						if(null!=this.parentbox)
							parentbox.addObj(this.obj);
						else if(null!=this.fkInput){
							this.fkInput.setCN(this.obj["ID"],this.obj["NAME"]);
							PopUpManager.removePopUp(this);
						}
				}catch(e:Error){
					Alert.show(e.getStackTrace());
				}
				
				
			}
			public function setObj(e:ListClickEnent):void{
				if(null!=this.fkInput && null!=this.obj){
					this.fkInput.setCN(e.obj["ID"],e.obj["NAME"]);
					PopUpManager.removePopUp(this);
				}
				this.obj=e.obj;
				
			}
		]]>
	</mx:Script>
	<mx:Box width="100%" height="100%">
		<mx:ApplicationControlBar height="50" width="100%" horizontalAlign="center">
			<mx:Label text="名称："/>
			<mx:TextInput width="90" id="keyinput"  keyUp="keysearch(event);"/>
			<mx:Button label="搜索" click="search();"/>
		</mx:ApplicationControlBar>
		<list:ListView id="searchrs" width="100%" height="90%"/>
		<mx:HBox horizontalAlign="center" width="100%">
			<mx:Button label="添加" click="addObj();"/>
			<mx:Button label="关闭" click="PopUpManager.removePopUp(this);"/>
		</mx:HBox>
	</mx:Box>
	
</mx:TitleWindow>
