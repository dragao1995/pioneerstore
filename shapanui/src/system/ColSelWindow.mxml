<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" 
	creationComplete="init();"
	width="290" height="400" xmlns:list="view.list.*">
	<mx:Script>
		<![CDATA[
			import mx.events.ListEvent;
			import mx.events.ItemClickEvent;
			import com.pioneer.http.UrlService;
			import mx.rpc.http.mxml.HTTPService;
			import mx.controls.dataGridClasses.DataGridColumn;
			import com.ResultFilter;
			import mx.rpc.events.ResultEvent;
			import mx.rpc.events.FaultEvent;
			import mx.containers.Box;
			import event.list.ListClickEnent;
			import mx.controls.Alert;
			import mx.managers.PopUpManager;
			private var tblName:String=null;
			private var obj:Object=null;
			
			private var parentbox:Object=null;
			private function init():void{
				
			}
			public function setParentBox(parentbox:Object):void{
				this.parentbox=parentbox;
			}
			public function setMeta(tblName:String):void{
				this.tblName=tblName;
				
				var qdoc:XML=<DATAPACKET/>
				qdoc.@TABLE=this.tblName;
				qdoc.@ACTION="detail";
				qdoc.@CONDITION=null;
				var dataService:HTTPService = new HTTPService();
				dataService.url = UrlService.getListUrl();
				dataService.contentType="application/xml";     
				dataService.method="POST";
				dataService.resultFormat = "e4x";
				dataService.showBusyCursor=true;
				dataService.addEventListener(FaultEvent.FAULT, onFaultHttpService);
				dataService.addEventListener(ResultEvent.RESULT, onDataResult);
				dataService.send(qdoc);
			}
			
			
			private function onFaultHttpService(e:FaultEvent):void
			{
				Alert.show("网络连接错误，请重试！");
			}
			private function onDataResult(e:ResultEvent):void{
			
			var data:XML=XML(e.result);
			if(!ResultFilter.filter(data))return;
			//Alert.show(data.toXMLString());
			
			var keyName:String=data.METADATA.TABLE.KEYS.KEY.@NAME;
			var mc2List:XMLList=data.METADATA.TABLE.FIELD;
			
			var columsArray:Array=new Array();
			var column1:DataGridColumn= new DataGridColumn();
             	column1.dataField="NAME";
				column1.headerText="编码";
				column1.width=50;
				
			
			var column2:DataGridColumn= new DataGridColumn();
             	column2.dataField="REMARK";
				column2.headerText="名称";
				column2.width=50;
				
				var column3:DataGridColumn= new DataGridColumn();
             	column3.dataField="TYPE";
				column3.headerText="类型";
				column3.width=50;
				columsArray.push(column2);
				//columsArray.push(column1);
				columsArray.push(column3);
				
				colsgrid.columns=columsArray;
				//组织显示数据
				var dataaArr:Array=new Array();
				for each(var col:XML in mc2List){
					var colName=col.@NAME;
					var colCode=col.@REMARK;
					if(keyName==colName)continue;
					
					if("X"==colName || "Y"==colName)continue;
					var obj:Object=new Object();
					obj["NAME"]=colName;
					obj["REMARK"]=col.@REMARK;
					obj["TYPE"]=col.@TYPE;
					obj["SIZE"]=col.@SIZE;
					obj["ISFK"]=col.@ISFK;
					obj["FKTBL"]=col.@FKTBL;
					obj["WIDTH"]=col.@WIDTH;
					obj["HEIGHT"]=col.@HEIGHT;
					obj["LABELWIDTH"]=col.@LABELWIDTH;
					//
					dataaArr.push(obj);
				}
				
				colsgrid.dataProvider=dataaArr;
		}
			
			public function addObj():void{
				if(null==this.obj){
					Alert.show("请选择确认的内容！");
					return;
				}
				try{
					//var box:Object=Object(this.parent);
					if(null==parentbox){
						Alert.show("没有设置调用窗口的对象！");						
					}else{
						parentbox.addObj(this.obj);
					}
				}catch(e:Error){
					Alert.show(e.getStackTrace());
				}
				
				
			}
			public function setObj(e:ListEvent):void{
				this.obj=colsgrid.selectedItem;
				var colName=this.obj["NAME"];
				this.obj["COLS"]=colName;
				
			}
		]]>
	</mx:Script>
	<mx:Box width="100%" height="100%">
		
		<mx:DataGrid id="colsgrid" width="100%" height="90%" itemClick="setObj(event)"/>
		
		<mx:HBox horizontalAlign="center" width="100%">
			<mx:Button label="添加" click="addObj();"/>
			<mx:Button label="关闭" click="PopUpManager.removePopUp(this);"/>
		</mx:HBox>
	</mx:Box>
	
</mx:TitleWindow>
